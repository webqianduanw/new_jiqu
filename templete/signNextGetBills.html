<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>每日签到领红包 </title>
      <script src="../js/setDpr.js"></script>
    <link rel="stylesheet" href="../css/signGetBills.css">
    <link rel="stylesheet" href="../css/swiper-4.2.6.min.css">
</head>
<body>

    <!--内容  -->
    <div id="root">
        <!--分享后 金币弹框  -->
        <div class="coinMask" v-show="coinMask" @click.self="closeMaskes()">
            <div class="coinMask_content">
                <img src="../icon/outerLink/icon_signed_getmoney_bg.png" alt="">
                <p>现金已到账</p>
                <p>6.6<span>元</span></p>
                <div class="coinMask_btn" @click="coinMask_btn()">
                    前往APP领取
                </div>
            </div>
        </div>
        <!--红包内容  -->
        <div class="contentOne">
            <div class="contentOne_head">
                <img src="../icon/outerLink/icon_signed_share_bg.png" alt="">
                <p>恭喜你获得现金红包</p>
                <p>6.6<span>元</span></p>
                <div class="contentOne_tipper" >
                    可提现
                </div>
            </div>
            <!--最后打开APP  -->
            <div class="lastTurnOn">
                 <div class="endOpen" @click="downLoadApp()">
                    前往APP内领取
                </div>
            </div>
            <!--swipper   -->
            <div class="scrollBox">
                <p>看看朋友手气如何</p>
                <div id="realUser">
                    <img :src="realyInfo.avator" alt="">
                    <div class="userNickName">{{realyInfo.nickName}}</div>
                    <div class="dollor">
						26.8元
					</div>
                </div>
                <div class="rolling">
					<div class="swiper-container" id="k_swiper_container">
						<div class="swiper-wrapper">
							<div class="swiper-slide">
								<div class="top">
									<img src="../imgIcon/2.png" alt="">
									<div class="info">
										哈皮
									</div>
									<div class="dollor">
										18.6元
									</div>
								</div>
                            </div>
                            <div class="swiper-slide">
								<div class="top">
									<img src="../imgIcon/7.jpg" alt="">
									<div class="info">
										智多星
									</div>
									<div class="dollor">
										18.6元
									</div>
								</div>
                            </div>
                            <div class="swiper-slide">
								<div class="top">
									<img src="../imgIcon/9.jpeg" alt="">
									<div class="info">
										一方_
									</div>
									<div class="dollor">
										18.6元
									</div>
								</div>
							</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="block" style="height:50px"></div>
        </div>
    </div>
</body>
<script src="../js/vue.js"></script>
<script src="../js/jquery.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="../js/swiper-4.2.6.min.js"></script>
<script src="../js/common.js"></script>
<script src="../js/JanesiBridges.js"></script>
<script>
var app = new Vue({
    el: '#root',
    data: {
        // 金币弹框
        coinMask:false,
        // 链接展示信息
        info: {
            title: '送你一个惊喜，点开后即可得奖励',
            desc: '送你一个限时福利，点击一下，你我都能拿钱，快，时间不多了',
            link: urlBase + '/janesi-headline/ZQFL/templete/signGetBills.html',
            imgUrl: 'http://tinterest.lechuangtec.com/janesi-headline/ZQFL/img/cai.png'
        },
        realyInfo:{
            avator:'../imgIcon/2.png',
            nickName:''
        },
        domainUrl:'' ,//跳转域名
        osType:''
    },
    created() {

    },
    mounted() {
        // 全局配置服务地址
        window.JanesiApi.reqUrl = requestUrl
        // 判断ostype
        if (window.JanesiBridge.isAndroid) {
            this.osType='ANDROID'
        } else {
            this.osType='IOS'
        }
        // swiper
        var rowHeight = document.getElementById('realUser').offsetHeight;
        var realHeight = rowHeight * 2;
        var swiper = new Swiper('.swiper-container', {
            direction: 'vertical',
            slidesPerView: 2,
            loop: true,
            height: realHeight,
            autoplay: {
                delay: 1000,
                disableOnInteraction: false,
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            }
        })
        let that = this
        that.domainAndParams()
         // 判断本地是否有值
        that.judgement()
        that.getUserInfo()
        that.getConfigParams()
        // 埋点
        that.showSixAndSix(             )

        // ready回调
        wx.ready(function(e){
            that.shareWx()
            that.shareFriendCircle()
            // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
        })
        // 清除本地缓存数据
        // localStorage.clear()
    },
    methods: {
        // 判断本地是否有值
        judgement(){
            let value = localStorage.getItem("second")
            console.log(value)
            if(value == 2){
            }else{
                this.coinMask = true
                localStorage.setItem('second','2')
            }
        },
        // 获取配置参数：
        getConfigParams(){
            let that = this
            // 获取地址栏url：
            JanesiApi.sendApi('/app/interest/config/wx_jsapi', 'post',{
                 reqUrl: window.location.href
            },function(res){
                var e = res.result
                that.sendWx(e)

            })
        },
        // 给将配置参数给微信
        sendWx(e) {
            wx.config({
                    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                    appId: e.appId, // 必填，公众号的唯一标识
                    timestamp: e.timestamp, // 必填，生成签名的时间戳
                    nonceStr: e.nonceStr, // 必填，生成签名的随机串
                    signature: e.signature,// 必填，签名
                    jsApiList: ['checkJsApi',
                                'onMenuShareTimeline',
                                'onMenuShareAppMessage'
                    ] // 必填，需要使用的JS接口列表
            })
        },

        // 分享到微信
        shareWx() {
            let that = this
            wx.onMenuShareAppMessage({
                title:  that.realyInfo.nickName + that.info.title, // 分享标题
                desc: that.realyInfo.nickName + that.info.desc, // 分享描述
                link: that.domainUrl + "/janesi-headline/ZQFL/templete/signGetBills.html?userId=" + that.getRequest()['userId'], // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                imgUrl: that.info.imgUrl, // 分享图标
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function (e) {
                    console.log(e)
                }
            })
        },

        // 分享到朋友圈
        shareFriendCircle() {
            let that = this
            wx.onMenuShareTimeline({
                title: that.info.title, // 分享标题
                link:  that.domainUrl + "/janesi-headline/ZQFL/templete/signGetBills.html?userId=" + that.getRequest()['userId'], // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                imgUrl: that.info.imgUrl, // 分享图标
                success: function (e) {

                }
            })
        },
        closeMaskes(){
            this.coinMask = false
        },
        downLoadApp() {
            this.pageGoToApp()
            this.coinMask = false
            window.location.href = 'http://yun.janesi.net/web/NEWS/newActivity/signGuideDownLoad.html'
        },
        coinMask_btn(){
            this.goToApp()
            this.coinMask = false
            window.location.href = 'http://yun.janesi.net/web/NEWS/newActivity/signGuideDownLoad.html'
        },
        //  获取用户头像
        getUserInfo() {
            let that = this
            JanesiApi.sendApi('/api/ucs/user/simple_info', 'post',{
                 userId: that.getRequest()['userId']
            },function(res){
                let e = res.result
                that.realyInfo = e
                if (!e.avator) {
                    that.realyInfo.avator = "http://tinterest.lechuangtec.com/janesi-headline/ZQFL/img/userPhoto.png"
                }
                if (!e.nickName) {
                    that.realyInfo.nickName = "游客"
                }
            })

        },
        //	itemId地址栏获取
        getRequest() {
            var url = location.href; //获取整个地址栏地址
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.split('?')[1];//截取？之后的所有参数
                str = str.split("&");  //将每个参数截取放置到数组
                for (var i = 0; i < str.length; i++) {
                    theRequest[str[i].split("=")[0]] = unescape(str[i].split("=")[1]);//将属性及属性值分别归属到数组
                }
            }
            return theRequest;
        },
        domainAndParams(){
            // 获取地址栏参数和域名
            let that = this
            let url = window.location.href;
            that.urlLastParams = url.split('?')[1]

            if (url.indexOf("mxsc") != -1) {
                that.domainUrl = "http://yun.mxsc.site"
            } else if (url.indexOf("52xh") != -1) {
                that.domainUrl = "http://yun.52xh.online"
            } else if (url.indexOf("52jskj") != -1) {
                that.domainUrl = "http://yun.52jskj.online"
            } else if(url.indexOf("janesi") != -1) {
                that.domainUrl = "http://yun.janesi.com"
            }
            console.log(that.urlLastParams)
            console.log(that.domainUrl)
        },
    // 埋点
        // 6.6页面曝光
        showSixAndSix(){
            window.JanesiApi.reqUrl = "http://spm.janesi.com"
                let that = this
                let myDate = new Date().getTime()
            JanesiApi.sendApi('/log/spm', 'get',{
                // userId: that.getRequest()['userId'],
                appId:'10010',
                osType: that.osType,
                eventType:'show',
                eventTime: myDate,
                end_type:'h5',
                url: window.location.href,
                referrer:'',
                h5_locaiton:'6.6Page'
            },function(res){
            })
        },
        // 弹框中的领取
        goToApp(){
            window.JanesiApi.reqUrl = "http://spm.janesi.com"
                let that = this
                let myDate = new Date().getTime()
            JanesiApi.sendApi('/log/spm', 'get',{
                // userId: that.getRequest()['userId'],
                appId:'10010',
                osType: that.osType,
                eventType:'click',
                eventTime: myDate,
                end_type:'h5',
                url: window.location.href,
                referrer:'',
                h5_locaiton:'share_recv_button'
            },function(res){
            })
        },
        // 页面中按钮领取
        pageGoToApp(){
            window.JanesiApi.reqUrl = "http://spm.janesi.com"
                let that = this
                let myDate = new Date().getTime()
            JanesiApi.sendApi('/log/spm', 'get',{
                // userId: that.getRequest()['userId'],
                appId:'10010',
                osType: that.osType,
                eventType:'click',
                eventTime: myDate,
                end_type:'h5',
                url: window.location.href,
                referrer:'',
                h5_locaiton:'refresh_share_recv_button'
            },function(res){
            })
        }

    }
})
</script>
</html>
